<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>PirateEvent.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">src (May 26, 2021 9:58:16 PM)</a> &gt; <a href="../../index.html" class="el_group">IslandTraderGUI</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">events</a> &gt; <span class="el_source">PirateEvent.java</span></div><h1>PirateEvent.java</h1><pre class="source lang-java linenums">package events;

import ships.Ship;
import trader.Trader;

/**
 * A class to implement the &quot;pirates&quot; random event, which causes
 * the player to fall victim to an attempted raid by pirates, losing their
 * items and possibly all their money if their {@link Trader}'s {@link Ship} is
 * defeated in battle with the pirates. If the pirates aren't satisfied by the
 * player's money, the player is forced to walk the plank and the game is over.
 * 
 * @author Finn van Dorsser
 * @author Meng Zhang
 *
 */
public class PirateEvent extends RandomEvent {
	
	/**
	 * the number of cannons equipped on the pirate's ship (for determining the
	 * outcome of a battle with the player's Ship).
	 */
	private int pirateCannons;
	
	/**
	 * the amount of money the pirates will attempt to steal from the player
	 * in addition to the value of all their items.
	 */
	private int pirateGreed;
	
	/**
	 * initialises a new PirateEvent and sets the {@link chanceLevel},
	 * {@link pirateCannons}, and {@link pirateGreed} to the given values.
	 * @param chanceLevel the number representing the likelihood of the event triggering
	 * on any one occasion
	 * @param pirateCannons the number of cannons for the pirates of this event
	 * @param pirateGreed the amount of money the pirates will attempt to steal from the
	 * player
	 */
<span class="fc" id="L40">	public PirateEvent(int chanceLevel, int pirateCannons, int pirateGreed) {</span>
<span class="fc" id="L41">		this.setChanceLevel(chanceLevel);</span>
<span class="fc" id="L42">		this.pirateCannons = pirateCannons;</span>
<span class="fc" id="L43">		this.pirateGreed = pirateGreed;</span>
<span class="fc" id="L44">	}</span>
	
	/**
	 * takes a player's {@link Ship} object and determines the outcome of the chase
	 * between the event's pirates and the player's Ship. The faster the Ship, the more
	 * likely it is to escape the pirates. If the Ship fails to outrun the pirates, 
	 * then the outcome will be determined by combat. Returns the outcome as a constant
	 * of type {@link PirateScenarios}.
	 * @param ship the player's Ship
	 * @return the outcome of the event as a {@link PirateScenarios} constant
	 */
	public PirateScenarios getChaseOutcome(Ship ship) {
<span class="fc" id="L56">		String shipSpeed = ship.getSpeed();</span>
<span class="pc bpc" id="L57" title="1 of 4 branches missed.">		switch (shipSpeed) {</span>
		case &quot;fast&quot;: 
<span class="fc" id="L59">			int fastRoll = getRandomInRange(0, 2);</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">			if (fastRoll &gt; 1) {</span>
<span class="fc" id="L61">				return PirateScenarios.FLED_AND_ESCAPED;</span>
			} else {
<span class="fc" id="L63">				return getFightOutcome(ship, false);</span>
			}
		case &quot;normal&quot;: 
<span class="fc" id="L66">			int normalRoll = getRandomInRange(0, 3);</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">			if (normalRoll &gt; 2) {</span>
<span class="fc" id="L68">				return PirateScenarios.FLED_AND_ESCAPED;</span>
			} else {
<span class="fc" id="L70">				return getFightOutcome(ship, false);</span>
			}
		case &quot;slow&quot;:
<span class="fc" id="L73">			int slowRoll = getRandomInRange(0, 4);</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">			if (slowRoll &gt; 3) {</span>
<span class="fc" id="L75">				return PirateScenarios.FLED_AND_ESCAPED;</span>
			} else {
<span class="fc" id="L77">				return getFightOutcome(ship, false);</span>
			}
		default:
<span class="nc" id="L80">			return getFightOutcome(ship, false);</span>
		}
	}
	
	/**
	 * takes a player's {@link Ship} object and a boolean value to represent whether
	 * the fight is voluntary (will currently always be set to false). Determines the 
	 * outcome of the fight between the event's pirates and the player's Ship. 
	 * The more cannons equipped on the Ship, the greater the chances of defeating the
	 * pirates. The greater the difference between the number of cannnons on the player's
	 * Ship and the pirates' {@link pirateCannons} value, the more likely it is that
	 * the party with the highest number will win. Returns the outcome as a constant
	 * of type {@link PirateScenarios}.
	 * @param ship the player's Ship
	 * @param voluntary true if the player decided to fight, false otherwise
	 * @return the outcome of the event as a {@link PirateScenarios} constant
	 */
	public PirateScenarios getFightOutcome(Ship ship, boolean voluntary) {
<span class="fc" id="L98">		int shipCannons = ship.getCannons();</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">		if (shipCannons &gt; pirateCannons) {</span>
<span class="nc" id="L100">			int maxRoll = 2 * shipCannons;</span>
<span class="nc" id="L101">			int threshold = pirateCannons;</span>
<span class="nc" id="L102">			int randomRoll = getRandomInRange(1, maxRoll);</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">			if (randomRoll &lt; threshold) {</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">				if (voluntary) {</span>
<span class="nc" id="L105">					return PirateScenarios.FOUGHT_AND_LOST;</span>
				} else {
<span class="nc" id="L107">					return PirateScenarios.FLED_AND_LOST;</span>
				}
<span class="nc bnc" id="L109" title="All 2 branches missed.">			} else if (voluntary) {</span>
<span class="nc" id="L110">				return PirateScenarios.FOUGHT_AND_WON;</span>
			} else {
<span class="nc" id="L112">				return PirateScenarios.FLED_AND_WON;</span>
			}
		} else {
<span class="fc" id="L115">			int maxRoll = 2 * pirateCannons;</span>
<span class="fc" id="L116">			int threshold = shipCannons;</span>
<span class="fc" id="L117">			int randomRoll = getRandomInRange(1, maxRoll);</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">			if (randomRoll &gt; threshold) {</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">				if (voluntary) {</span>
<span class="fc" id="L120">					return PirateScenarios.FOUGHT_AND_LOST;</span>
				} else {
<span class="fc" id="L122">					return PirateScenarios.FLED_AND_LOST;</span>
				}
<span class="nc bnc" id="L124" title="All 2 branches missed.">			} else if (voluntary) {</span>
<span class="nc" id="L125">				return PirateScenarios.FOUGHT_AND_WON;</span>
			} else {
<span class="nc" id="L127">				return PirateScenarios.FLED_AND_WON;</span>
			}
		}
	}
	
	/**
	 * takes an event outcome of type {@link PirateScenarios} and returns a corresponding report
	 * String detailing the outcome of the event and the impact (if any) on the player.
	 * @param outcome the outcome of the event as a {@link PirateScenarios} constant
	 * @return a report String detailing the outcome and impacts (if any) of the event
	 */
	public String getReport(PirateScenarios outcome) {
<span class="fc" id="L139">		String reportString = &quot;Oh no! You were beset by pirates!\n&quot;;</span>
<span class="pc bpc" id="L140" title="4 of 6 branches missed.">		switch (outcome) {</span>
		case FLED_AND_ESCAPED:
<span class="fc" id="L142">			return reportString + &quot;Don't worry; your ship was just fast enough to outrun the pirates this time!\n&quot;;</span>
		case FLED_AND_LOST:
<span class="fc" id="L144">			return reportString + &quot;Disaster! Your crew tried to flee but the pirates caught up with you, \ndefeated you in battle, and made off with all your cargo!\n&quot; +</span>
<span class="fc" id="L145">			&quot;They also took &quot; + this.pirateGreed + &quot; coins.\n&quot; +</span>
<span class="fc" id="L146">			&quot;Your cannons weren't enough to protect you this time.\n&quot;;</span>
		case FLED_AND_WON:
<span class="nc" id="L148">			return reportString + &quot;Wow, that was lucky! The pirates caught up with you but you defeated them in battle!\n&quot;</span>
<span class="nc" id="L149">					+ &quot;Your cannons were enough to protect you this time...\n&quot;;</span>
		case FOUGHT_AND_LOST:
<span class="nc" id="L151">			return reportString + &quot;OOF! The pirates defeated you in battle and made off with all your cargo!!\n&quot; +</span>
<span class="nc" id="L152">			&quot;They also took &quot; + this.pirateGreed + &quot; coins.\n&quot; +</span>
<span class="nc" id="L153">			&quot;Your cannons weren't enough to protect you this time.\n&quot;;</span>
		case FOUGHT_AND_WON:
<span class="nc" id="L155">			return reportString + &quot;But don't worry; you defeated them in battle.\n&quot; +</span>
<span class="nc" id="L156">			&quot;Your cannons were enough to protect you this time...\n&quot;;</span>
		}
<span class="nc" id="L158">		return &quot;Missing a PirateScenarios case!&quot;;</span>
	}
	
	/**
	 * takes an event outcome of type {@link PirateScenarios} and returns true if the player lost the battle
	 * this time and will therefore be looted, and false if not.
	 * @param outcome the outcome of the event as a {@link PirateScenarios} constant
	 * @return a boolean value indicating whether the player is to be looted as a result of the event
	 */
	public boolean decideLooted(PirateScenarios outcome) {
<span class="pc bpc" id="L168" title="1 of 4 branches missed.">		return (outcome == PirateScenarios.FLED_AND_LOST || outcome == PirateScenarios.FOUGHT_AND_LOST);</span>
	}
	
	/**
	 * processes the impact of the triggered PirateEvent on the given {@link Trader}
	 * and returns a report detailing this impact to be displayed to the player.
	 * @return a report String detailing the impact of the event and to be displayed
	 * to the player 
	 */
	public String processImpact(Trader player) {
<span class="fc" id="L178">		Ship ship = player.getOwndedShip();</span>
<span class="fc" id="L179">		PirateScenarios outcome = getChaseOutcome(ship);</span>
<span class="fc" id="L180">		String reportString = getReport(outcome);</span>
<span class="fc bfc" id="L181" title="All 2 branches covered.">		if (decideLooted(outcome)) {</span>
<span class="fc" id="L182">			int playerMoney = player.getOwnedMoney();</span>
<span class="fc" id="L183">			player.getOwndedShip().emptyCargos();</span>
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">			if (pirateGreed &gt;= playerMoney) {</span>
<span class="nc" id="L185">				player.setOwnedMoney(0);</span>
<span class="nc" id="L186">				player.setKilledByPirates(true);</span>
<span class="nc" id="L187">				reportString = &quot;Oh no! You were beset by pirates!\n&quot; +</span>
						&quot;They defeated you in battle, took everything of value, and made you and your crew walk the plank!\n&quot; +
						&quot;Better luck next time!&quot;;
<span class="nc" id="L190">			} else {</span>
<span class="fc" id="L191">				player.subtractMoney(pirateGreed);</span>
			}
<span class="fc" id="L193">		} return reportString;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span>src (May 26, 2021 9:58:16 PM)</div></body></html>